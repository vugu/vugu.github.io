<html><head>

<title>Vugu Program Structure</title>




<!-- link rel="manifest" href="/assets/images/favicon/site.webmanifest" -->

<meta name="msapplication-TileColor" content="#da532c"/>
<meta name="theme-color" content="#ffffff"/>

<!-- <title>{{.Title}}</title> -->
<!-- <title>Vugu Dev - {{.Request.URL.Path}}</title> -->
<!-- {{end}} -->
<meta charset="utf-8"/>

<meta name="description" content="WebAssembly main: Like any Go program, it starts with main function. To render a page to HTML, you need a root component - lives in root.vugu by default. Once we have a root component instance, we need an environment."/>

<!-- {{if .MetaTags}}{{range $k, $v := .MetaTags}} -->
<!-- <meta name="{{$k}}" content="{{$v}}"/> -->
<!-- {{end}}{{end}} -->
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- {{if .CSSFiles}}{{range $f := .CSSFiles}} -->
<!-- <link rel="stylesheet" href="{{$f}}" /> -->



<!-- {{end}}{{end}} -->
 <!-- MS Edge polyfill -->
<!-- <script src="/wasm_exec.js"></script> -->


<!-- Global site tag (gtag.js) - Google Analytics -->





<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png"/><link rel="mask-icon" href="/assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/assets/css/vendor.css"/><link rel="stylesheet" href="/assets/css/style.css"/><link rel="stylesheet" href="/assets/css/custom.css"/><style>
    #root .header {
        background: #72ceff
    }
    
    #root .header + section {
        padding-top: 0;
    }
    
    /* code formatting */
    #root pre.chroma {
        border: 4px solid #f1f1f1;
    }
    
    #root .chroma .err {
        background-color: transparent;
    }
    
</style></head><body><div id="root">
<!-- {{if .ServerRenderedOutput}}{{.ServerRenderedOutput}}{{else}} -->
<!-- <img style="position: absolute; top: 50%; left: 50%;" src="https://cdnjs.cloudflare.com/ajax/libs/galleriffic/2.0.1/css/loader.gif"> -->
<!-- {{end}} -->

<header class="header">
        <div class="container">
          <div class="row">
            <nav class="navbar navbar-expand-lg navbar-light">
              <a href="/" class="navbar-brand"><img src="/assets/images/logo-white.svg" alt="Logo"/></a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
  
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                    <a href="/" class="nav-link">Home</a>
                  </li>
                  <li class="nav-item">
                    <a href="/doc/start" class="nav-link">Getting Started</a>
                  </li>
                  <li class="nav-item">
                    <a href="/doc" class="nav-link active ">Documentation</a>
                  </li>
                  <li class="nav-item">
                    <a href="/faq" class="nav-link">faq</a>
                  </li>
                </ul>
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="https://github.com/vugu/vugu" target="_blank">GitHub</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="https://godoc.org/github.com/vugu/vugu" target="_blank">GoDoc</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="https://play.vugu.org/" target="_blank">Playground</a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
        </div>
      </header>

<div>
<section class="hero bg-blue">
    <div class="container">
      <div class="row">
        <div class="col-md-8 text-white mb-3">
          <h1 class="h2 pb-1 pt-2">Vugu Program Structure</h1>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-minimal">
              <li class="breadcrumb-item"><a href="/" notclick="data.Router.BrowseTo(&#34;/&#34;, event)">Home</a></li>
              <li class="breadcrumb-item"><a href="/doc" notclick="data.Router.BrowseTo(&#34;/doc&#34;, event)">Doc</a></li>
              <li class="breadcrumb-item active">Program Structure</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </section>
</div>

<section class="mb-2">
    <div class="container overlay-item-top">
        <div class="row">
            <div class="col">
                <div class="content boxed">
                    <div class="row separated">

                        

                        <article class="col-md-8 content-body">
                            <div>

                  <p>Vugu takes a number of steps to make the development process easy to rapidly 
                    get started and prototype user interfaces.  That said, it&#39;s important to 
                    understand the overall program structure and how a Vugu program works (at least by
                    default), so you can customize it to your needs when building a sophisticated 
                    application.  The basics are fairly simple.
                  </p>

                  <p>
                    When you use the HTTP handler in development mode (as shown on the 
                    <a href="/doc/start" notclick="data.Router.BrowseTo(&#34;/doc/start&#34;, event)">Getting Started</a> page), upon page load 
                    Vugu will convert your .vugu files into .go and also by default attempt to generate a main_wasm.go if it does not exist.
                    (You can edit main_wasm.go as needed. It is only a template to get your started. Vugu will not overwrite it.)
                  </p>

                  <h2>WebAssembly main()</h2>

                  <p>
                    Like any Go program, it starts with <code>main()</code>.   The build constraint at the top (see 
                    <a href="#dual-build">Dual-Build</a> below) indicates this is the WebAssembly entry point:
                  </p>

<div>
<style type="text/css">
/* Background */ .chroma { color: #272822; background-color: #fafafa }
/* Error */ .chroma .err { color: #960050; background-color: #1e0010 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #e1e1e1 }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* Keyword */ .chroma .k { color: #00a8c8 }
/* KeywordConstant */ .chroma .kc { color: #00a8c8 }
/* KeywordDeclaration */ .chroma .kd { color: #00a8c8 }
/* KeywordNamespace */ .chroma .kn { color: #f92672 }
/* KeywordPseudo */ .chroma .kp { color: #00a8c8 }
/* KeywordReserved */ .chroma .kr { color: #00a8c8 }
/* KeywordType */ .chroma .kt { color: #00a8c8 }
/* Name */ .chroma .n { color: #111111 }
/* NameAttribute */ .chroma .na { color: #75af00 }
/* NameBuiltin */ .chroma .nb { color: #111111 }
/* NameBuiltinPseudo */ .chroma .bp { color: #111111 }
/* NameClass */ .chroma .nc { color: #75af00 }
/* NameConstant */ .chroma .no { color: #00a8c8 }
/* NameDecorator */ .chroma .nd { color: #75af00 }
/* NameEntity */ .chroma .ni { color: #111111 }
/* NameException */ .chroma .ne { color: #75af00 }
/* NameFunction */ .chroma .nf { color: #75af00 }
/* NameFunctionMagic */ .chroma .fm { color: #111111 }
/* NameLabel */ .chroma .nl { color: #111111 }
/* NameNamespace */ .chroma .nn { color: #111111 }
/* NameOther */ .chroma .nx { color: #75af00 }
/* NameProperty */ .chroma .py { color: #111111 }
/* NameTag */ .chroma .nt { color: #f92672 }
/* NameVariable */ .chroma .nv { color: #111111 }
/* NameVariableClass */ .chroma .vc { color: #111111 }
/* NameVariableGlobal */ .chroma .vg { color: #111111 }
/* NameVariableInstance */ .chroma .vi { color: #111111 }
/* NameVariableMagic */ .chroma .vm { color: #111111 }
/* Literal */ .chroma .l { color: #ae81ff }
/* LiteralDate */ .chroma .ld { color: #d88200 }
/* LiteralString */ .chroma .s { color: #d88200 }
/* LiteralStringAffix */ .chroma .sa { color: #d88200 }
/* LiteralStringBacktick */ .chroma .sb { color: #d88200 }
/* LiteralStringChar */ .chroma .sc { color: #d88200 }
/* LiteralStringDelimiter */ .chroma .dl { color: #d88200 }
/* LiteralStringDoc */ .chroma .sd { color: #d88200 }
/* LiteralStringDouble */ .chroma .s2 { color: #d88200 }
/* LiteralStringEscape */ .chroma .se { color: #8045ff }
/* LiteralStringHeredoc */ .chroma .sh { color: #d88200 }
/* LiteralStringInterpol */ .chroma .si { color: #d88200 }
/* LiteralStringOther */ .chroma .sx { color: #d88200 }
/* LiteralStringRegex */ .chroma .sr { color: #d88200 }
/* LiteralStringSingle */ .chroma .s1 { color: #d88200 }
/* LiteralStringSymbol */ .chroma .ss { color: #d88200 }
/* LiteralNumber */ .chroma .m { color: #ae81ff }
/* LiteralNumberBin */ .chroma .mb { color: #ae81ff }
/* LiteralNumberFloat */ .chroma .mf { color: #ae81ff }
/* LiteralNumberHex */ .chroma .mh { color: #ae81ff }
/* LiteralNumberInteger */ .chroma .mi { color: #ae81ff }
/* LiteralNumberIntegerLong */ .chroma .il { color: #ae81ff }
/* LiteralNumberOct */ .chroma .mo { color: #ae81ff }
/* Operator */ .chroma .o { color: #f92672 }
/* OperatorWord */ .chroma .ow { color: #f92672 }
/* Punctuation */ .chroma .p { color: #111111 }
/* Comment */ .chroma .c { color: #75715e }
/* CommentHashbang */ .chroma .ch { color: #75715e }
/* CommentMultiline */ .chroma .cm { color: #75715e }
/* CommentSingle */ .chroma .c1 { color: #75715e }
/* CommentSpecial */ .chroma .cs { color: #75715e }
/* CommentPreproc */ .chroma .cp { color: #75715e }
/* CommentPreprocFile */ .chroma .cpf { color: #75715e }
/* GenericEmph */ .chroma .ge { font-style: italic }
/* GenericStrong */ .chroma .gs { font-weight: bold }
nobody { color: #272822; background-color: #fafafa; }
</style>
<pre class="chroma"><span class="c1">// +build wasm
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="c1">// ...
</span><span class="c1"></span>	<span class="s">&#34;github.com/vugu/vugu&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span></pre>


</div>


                  <!--
                  <p>TODO: we need to explain key concepts here like the rneder loop and touch upon lock with EventEnv - 
                    maybe not the deep dive through every line.  Also touch upon the build tags producing two programs - one for wasm 
                    and one that's the server (default setup, normal GO package and module system applies and we're not doing 
                    anything that isn't standard Go.)  

                    An example of http.Get and the locking should probably go here 
                  </p>
                  -->

                  <!--
                  <h2>Main</h2>

                  <p>
                    Here is an example of a working <code>main.go</code>:
                  </p>
                  
                  <p><pre><code>// +build wasm

package main

import (
	"log"
	"os"

	"github.com/vugu/vugu"
)

func main() {

	println("Entering main()")
	defer println("Exiting main()")

	rootInst, err := vugu.New(&Root{}, nil)
	if err != nil {
		log.Fatal(err)
	}

	env := vugu.NewJSEnv("#root_mount_parent", rootInst, vugu.RegisteredComponentTypes())
	env.DebugWriter = os.Stdout

	for ok := true; ok; ok = env.EventWait() {
		err = env.Render()
		if err != nil {
			panic(err)
		}
	}

}
</code></pre></p>
-->

                  <!--
                  <p>That's a fair bit to take in.  Let's go through each part.</p>

                  <p>
                    The first line is a <a target="_blank" href="https://golang.org/pkg/go/build/#hdr-Build_Constraints">build tag</a>,
                    indicating that this program should only be compiled for WebAssembly:
                    <pre><code>// +build wasm</code></pre></p>

                  <p>Program Overview (incl: Render loop)</p>
                  -->

                  <h2>Root Component</h2>

                  <p>To render a page to HTML, you need to have &#34;root&#34; component. This is the top level component that
                    houses everything else.  By default this component lives in root.vugu, gets code generated to 
                    root_vgen.go, which has a Root struct type.  The generated main_wasm.go file creates an instance 
                    of this Root struct and uses it as the beginning of the tree of components to be rendered.
                   </p>

                   <h2>BuildEnv</h2>

                   <p><a target="_blank" href="https://godoc.org/github.com/vugu/vugu#BuildEnv">BuildEnv</a> 
                  keeps track of component state across render cycles.  Component re-use from render to render
                  and detecting which components are changed are handled here.  You can get a new instance by 
                  calling <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#NewBuildEnv">vugu.NewBuildEnv</a>.
                </p>

                  <h2>JSRenderer</h2>

                  <p>Once we have a root component instance, we need an environment.  There are two environments currently implemented:
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu/domrender">the DOM renderer</a>
                    for use in WebAssembly applications, and 
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu/staticrender">the static renderer</a> 
                    which can be used for server-side rendering and tests. 
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu/domrender#JSRenderer">domrender.JSRenderer</a>
                    is what performs the syncing of the virtual DOM from 
                    our root component and any nested components to the browser DOM.
                  </p>

<!-- 
                  <p>
                    <ul>
                      <li class="pb-2">
                    The first argument is the location in the page (CSS selector, readable by 
                    <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector">querySelector</a>)
                    of where the component is "mounted".  By default <code>#root_mount_parent</code> corresponds to 
                    a <code><div></code> immediately inside the <code><body></code> tag.</li>  
                    <li class="pb-2">The second argument is the 
                    component instance we created above.  </li>
                    <li>
                    And the last argument is a map of which component types are available 
                    under which names. The function 
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#RegisteredComponentTypes">vugu.RegisteredComponentTypes</a>
                     will retreive all of the components that have 
                    registered themselves with 
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#RegisterComponentType">vugu.RegisterComponentType</a>
                    (which is the case for all components by default).
                    This makes it so you can simply <code>import _ "path/to/other/components"</code> and they will be 
                    available automatically.  Components defined directly in your main package are also always available by default.
                  </li>
                    </ul>
                  </p>
                    <p>If you need more control over which component types are available during rendering and the names
                    they use, or where your application is output on the page, customizing what you pass to <code>NewJSEnv</code> is the way to do it.
                  </p> -->

                  <h2>Render Loop</h2>

                  <p>The render loop is where the magic happens.  Your components&#39; virtual DOM output (see 
                    <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#BuildOut">BuildOut</a>) 
                    is generated and then synchronized with 
                    the browser&#39;s DOM to give you a matching HTML page.  This involves various optimizations including keeping 
                    track of which components have changed and caching those that haven&#39;t.
                  </p>

<div>
<style type="text/css">
/* Background */ .chroma { color: #272822; background-color: #fafafa }
/* Error */ .chroma .err { color: #960050; background-color: #1e0010 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #e1e1e1 }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* Keyword */ .chroma .k { color: #00a8c8 }
/* KeywordConstant */ .chroma .kc { color: #00a8c8 }
/* KeywordDeclaration */ .chroma .kd { color: #00a8c8 }
/* KeywordNamespace */ .chroma .kn { color: #f92672 }
/* KeywordPseudo */ .chroma .kp { color: #00a8c8 }
/* KeywordReserved */ .chroma .kr { color: #00a8c8 }
/* KeywordType */ .chroma .kt { color: #00a8c8 }
/* Name */ .chroma .n { color: #111111 }
/* NameAttribute */ .chroma .na { color: #75af00 }
/* NameBuiltin */ .chroma .nb { color: #111111 }
/* NameBuiltinPseudo */ .chroma .bp { color: #111111 }
/* NameClass */ .chroma .nc { color: #75af00 }
/* NameConstant */ .chroma .no { color: #00a8c8 }
/* NameDecorator */ .chroma .nd { color: #75af00 }
/* NameEntity */ .chroma .ni { color: #111111 }
/* NameException */ .chroma .ne { color: #75af00 }
/* NameFunction */ .chroma .nf { color: #75af00 }
/* NameFunctionMagic */ .chroma .fm { color: #111111 }
/* NameLabel */ .chroma .nl { color: #111111 }
/* NameNamespace */ .chroma .nn { color: #111111 }
/* NameOther */ .chroma .nx { color: #75af00 }
/* NameProperty */ .chroma .py { color: #111111 }
/* NameTag */ .chroma .nt { color: #f92672 }
/* NameVariable */ .chroma .nv { color: #111111 }
/* NameVariableClass */ .chroma .vc { color: #111111 }
/* NameVariableGlobal */ .chroma .vg { color: #111111 }
/* NameVariableInstance */ .chroma .vi { color: #111111 }
/* NameVariableMagic */ .chroma .vm { color: #111111 }
/* Literal */ .chroma .l { color: #ae81ff }
/* LiteralDate */ .chroma .ld { color: #d88200 }
/* LiteralString */ .chroma .s { color: #d88200 }
/* LiteralStringAffix */ .chroma .sa { color: #d88200 }
/* LiteralStringBacktick */ .chroma .sb { color: #d88200 }
/* LiteralStringChar */ .chroma .sc { color: #d88200 }
/* LiteralStringDelimiter */ .chroma .dl { color: #d88200 }
/* LiteralStringDoc */ .chroma .sd { color: #d88200 }
/* LiteralStringDouble */ .chroma .s2 { color: #d88200 }
/* LiteralStringEscape */ .chroma .se { color: #8045ff }
/* LiteralStringHeredoc */ .chroma .sh { color: #d88200 }
/* LiteralStringInterpol */ .chroma .si { color: #d88200 }
/* LiteralStringOther */ .chroma .sx { color: #d88200 }
/* LiteralStringRegex */ .chroma .sr { color: #d88200 }
/* LiteralStringSingle */ .chroma .s1 { color: #d88200 }
/* LiteralStringSymbol */ .chroma .ss { color: #d88200 }
/* LiteralNumber */ .chroma .m { color: #ae81ff }
/* LiteralNumberBin */ .chroma .mb { color: #ae81ff }
/* LiteralNumberFloat */ .chroma .mf { color: #ae81ff }
/* LiteralNumberHex */ .chroma .mh { color: #ae81ff }
/* LiteralNumberInteger */ .chroma .mi { color: #ae81ff }
/* LiteralNumberIntegerLong */ .chroma .il { color: #ae81ff }
/* LiteralNumberOct */ .chroma .mo { color: #ae81ff }
/* Operator */ .chroma .o { color: #f92672 }
/* OperatorWord */ .chroma .ow { color: #f92672 }
/* Punctuation */ .chroma .p { color: #111111 }
/* Comment */ .chroma .c { color: #75715e }
/* CommentHashbang */ .chroma .ch { color: #75715e }
/* CommentMultiline */ .chroma .cm { color: #75715e }
/* CommentSingle */ .chroma .c1 { color: #75715e }
/* CommentSpecial */ .chroma .cs { color: #75715e }
/* CommentPreproc */ .chroma .cp { color: #75715e }
/* CommentPreprocFile */ .chroma .cpf { color: #75715e }
/* GenericEmph */ .chroma .ge { font-style: italic }
/* GenericStrong */ .chroma .gs { font-weight: bold }
nobody { color: #272822; background-color: #fafafa; }
</style>
<pre class="chroma"><span class="k">for</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">ok</span><span class="p">;</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nf">EventWait</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">buildResults</span> <span class="o">:=</span> <span class="nx">buildEnv</span><span class="p">.</span><span class="nf">RunBuild</span><span class="p">(</span><span class="nx">rootBuilder</span><span class="p">)</span>
    <span class="nx">err</span> <span class="p">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">buildResults</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></pre>


</div>

                  <p>
                    This will call <code>RunBuild</code> and then <code>Render</code> immediately the first time and then wait for 
                    <code>renderer.EventWait()</code> to return and render again.
                  </p>


                  <div class="alert alert-warning" role="alert">
                      <i class="icon-alert-circle"></i>
                      <h4 class="fs-22">Important Note</h4>
                      <p>When 
                          <a href="/doc/dom-events" notclick="data.Router.BrowseTo(&#34;/doc/dom-events&#34;, event)">DOM Events</a> 
                          are handled, a (write) lock is acquired against the environment automatically
                        and then released when your event handler returns.  When things that would block (like fetching 
                        data from the server over HTTP) need to be done, this must be run in a goroutine which uses
                        <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#DOMEvent.EventEnv">event.EventEnv()</a> 
                        to acquire their own lock before modifying any component data, to ensure they don&#39;t interfere with the render loop or other code.
                        Locking should only be done during data modification and then unlocked immediately afterward.  <strong>Do not put a
                          <code>Lock()</code> before <code>http.Get()</code> or other such 
                          <a target="_blank" href="https://en.wikipedia.org/wiki/Blocking_(computing)">blocking</a> calls.</strong>  Instead <code>Lock()</code> after 
                          you have your data and before updating
                        the state of your component.
                        <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#EventEnv">EventEnv.UnlockRender()</a>
                        will cause the <code>renderer.EventWait()</code> call above to return and update the page.
                        (Whereas <a target="_blank" href="https://godoc.org/github.com/vugu/vugu#EventEnv">EventEnv.UnlockOnly()</a>
                        will release the lock but not cause the page update. This is useful if 
                        you need to do several updates to data at different times
                        but only care to refresh the page after they are all done.)
                        See <a href="/doc/files/code">Code</a> for a correct example.</p>
                    </div>
  

                  <p><code>EventWait</code> will return false if it detects something wrong with the environment
                    and the program should exit.
                    This should release any resources and be a clean exit from the program when the page goes away.
                  </p>


                  <h2>main_wasm.go</h2>

                  <p>If we take a look at the main_wasm.go file that is generated by default, it gives us a pretty good 
                    idea of how these fit together:
                  </p>

<div>
<style type="text/css">
/* Background */ .chroma { color: #272822; background-color: #fafafa }
/* Error */ .chroma .err { color: #960050; background-color: #1e0010 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #e1e1e1 }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* Keyword */ .chroma .k { color: #00a8c8 }
/* KeywordConstant */ .chroma .kc { color: #00a8c8 }
/* KeywordDeclaration */ .chroma .kd { color: #00a8c8 }
/* KeywordNamespace */ .chroma .kn { color: #f92672 }
/* KeywordPseudo */ .chroma .kp { color: #00a8c8 }
/* KeywordReserved */ .chroma .kr { color: #00a8c8 }
/* KeywordType */ .chroma .kt { color: #00a8c8 }
/* Name */ .chroma .n { color: #111111 }
/* NameAttribute */ .chroma .na { color: #75af00 }
/* NameBuiltin */ .chroma .nb { color: #111111 }
/* NameBuiltinPseudo */ .chroma .bp { color: #111111 }
/* NameClass */ .chroma .nc { color: #75af00 }
/* NameConstant */ .chroma .no { color: #00a8c8 }
/* NameDecorator */ .chroma .nd { color: #75af00 }
/* NameEntity */ .chroma .ni { color: #111111 }
/* NameException */ .chroma .ne { color: #75af00 }
/* NameFunction */ .chroma .nf { color: #75af00 }
/* NameFunctionMagic */ .chroma .fm { color: #111111 }
/* NameLabel */ .chroma .nl { color: #111111 }
/* NameNamespace */ .chroma .nn { color: #111111 }
/* NameOther */ .chroma .nx { color: #75af00 }
/* NameProperty */ .chroma .py { color: #111111 }
/* NameTag */ .chroma .nt { color: #f92672 }
/* NameVariable */ .chroma .nv { color: #111111 }
/* NameVariableClass */ .chroma .vc { color: #111111 }
/* NameVariableGlobal */ .chroma .vg { color: #111111 }
/* NameVariableInstance */ .chroma .vi { color: #111111 }
/* NameVariableMagic */ .chroma .vm { color: #111111 }
/* Literal */ .chroma .l { color: #ae81ff }
/* LiteralDate */ .chroma .ld { color: #d88200 }
/* LiteralString */ .chroma .s { color: #d88200 }
/* LiteralStringAffix */ .chroma .sa { color: #d88200 }
/* LiteralStringBacktick */ .chroma .sb { color: #d88200 }
/* LiteralStringChar */ .chroma .sc { color: #d88200 }
/* LiteralStringDelimiter */ .chroma .dl { color: #d88200 }
/* LiteralStringDoc */ .chroma .sd { color: #d88200 }
/* LiteralStringDouble */ .chroma .s2 { color: #d88200 }
/* LiteralStringEscape */ .chroma .se { color: #8045ff }
/* LiteralStringHeredoc */ .chroma .sh { color: #d88200 }
/* LiteralStringInterpol */ .chroma .si { color: #d88200 }
/* LiteralStringOther */ .chroma .sx { color: #d88200 }
/* LiteralStringRegex */ .chroma .sr { color: #d88200 }
/* LiteralStringSingle */ .chroma .s1 { color: #d88200 }
/* LiteralStringSymbol */ .chroma .ss { color: #d88200 }
/* LiteralNumber */ .chroma .m { color: #ae81ff }
/* LiteralNumberBin */ .chroma .mb { color: #ae81ff }
/* LiteralNumberFloat */ .chroma .mf { color: #ae81ff }
/* LiteralNumberHex */ .chroma .mh { color: #ae81ff }
/* LiteralNumberInteger */ .chroma .mi { color: #ae81ff }
/* LiteralNumberIntegerLong */ .chroma .il { color: #ae81ff }
/* LiteralNumberOct */ .chroma .mo { color: #ae81ff }
/* Operator */ .chroma .o { color: #f92672 }
/* OperatorWord */ .chroma .ow { color: #f92672 }
/* Punctuation */ .chroma .p { color: #111111 }
/* Comment */ .chroma .c { color: #75715e }
/* CommentHashbang */ .chroma .ch { color: #75715e }
/* CommentMultiline */ .chroma .cm { color: #75715e }
/* CommentSingle */ .chroma .c1 { color: #75715e }
/* CommentSpecial */ .chroma .cs { color: #75715e }
/* CommentPreproc */ .chroma .cp { color: #75715e }
/* CommentPreprocFile */ .chroma .cpf { color: #75715e }
/* GenericEmph */ .chroma .ge { font-style: italic }
/* GenericStrong */ .chroma .gs { font-weight: bold }
nobody { color: #272822; background-color: #fafafa; }
</style>
<pre class="chroma"><span class="c1">// +build wasm
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;log&#34;</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;flag&#34;</span>

    <span class="s">&#34;github.com/vugu/vugu&#34;</span>
    <span class="s">&#34;github.com/vugu/vugu/domrender&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">mountPoint</span> <span class="o">:=</span> <span class="nx">flag</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;mount-point&#34;</span><span class="p">,</span> <span class="s">&#34;#vugu_mount_point&#34;</span><span class="p">,</span> <span class="s">&#34;The query selector for the mount point for the root component, if it is not a full HTML component&#34;</span><span class="p">)</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Entering main(), -mount-point=%q\n&#34;</span><span class="p">,</span> <span class="o">*</span><span class="nx">mountPoint</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Exiting main()\n&#34;</span><span class="p">)</span>

    <span class="nx">rootBuilder</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Root</span><span class="p">{}</span>

    <span class="nx">buildEnv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">vugu</span><span class="p">.</span><span class="nf">NewBuildEnv</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">renderer</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">domrender</span><span class="p">.</span><span class="nf">NewJSRenderer</span><span class="p">(</span><span class="o">*</span><span class="nx">mountPoint</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">renderer</span><span class="p">.</span><span class="nf">Release</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">ok</span><span class="p">;</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nf">EventWait</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">buildResults</span> <span class="o">:=</span> <span class="nx">buildEnv</span><span class="p">.</span><span class="nf">RunBuild</span><span class="p">(</span><span class="nx">rootBuilder</span><span class="p">)</span>

        <span class="nx">err</span> <span class="p">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">buildResults</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
	
<span class="p">}</span>
</pre>


</div>


                  <h2 id="dual-build">The Dual-Build Approach</h2>

                  <p>The discussion above is only about the WebAssembly side of your application.</p>

                  <p>
                    Using Go&#39;s <a href="https://golang.org/pkg/go/build/#hdr-Build_Constraints">build constraints</a>
                    it is easy to output two different executables from your same package directory.
                    The common case is that you want a client-side build that compiles to WebAssembly (as discussed above), 
                    as well as a server-side executable to act as a web server.  These each need different 
                    main() and likely other functions, but your components and other functionality should
                    be available both in your WebAssembly output and in your server program.
                  </p>

                  <p>
                    This is why the <code>main()</code> function for your client-side application lives in 
                    <em>main_wasm.go</em>.  The &#34;_wasm&#34; part indicates that the file should be included during 
                    a WebAssembly build.  You can and should include a server-side <code>main()</code> in another file
                    and use <nobr><code>// +build !wasm</code></nobr> at the top as the inverse build constraint. 
                    See <a href="/doc/build-and-dist" notclick="data.Router.BrowseTo(&#34;/doc/build-and-dist&#34;, event)">Building and Distribution</a>
                    for more info.
                  </p>


</div>
                        </article>
                        <aside class="col-md-4 content-aside bg-light">
                            <div class="widget">
    <h3 class="widget-title">Documentation</h3>
    <div class="list-group list-group-related">

        <!-- active -->
        <a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>What is Vugu?</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/start">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Getting Started</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/files">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Vugu Files</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/files/markup">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Markup (HTML/Go)</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/files/style">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Styles (CSS)</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/files/code">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Code (Go)</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/dom-events">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>DOM Events</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/components">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Using Components</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center active" href="/doc/program">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Program Structure</span>
        </a><a class="list-group-item list-group-item-action d-flex align-items-center " href="/doc/build-and-dist">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span>Building and Distribution</span>
        </a>

        <!-- <a vg-for="allPages.SiteDocPages()" :href="value.Path"
            @click="data.Router.BrowseTo(value.Path, event)"
            class="list-group-item list-group-item-action d-flex align-items-center active">
            <i class="fs-20 icon-file-text2 text-primary mr-1"></i>
            <span vg-html="value.ShortTitle"></span>
        </a> -->

    </div>
</div>
                        </aside>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



<footer class="bg-dark">

    <div class="container">

        <div class="row gutter-0">
            <div class="col-12 col-md-6">
                <h4 class="prev-next-part">
                    <a href="/doc/components">« Using Components</a>
                </h4>
            </div>
            <div class="col-12 col-md-6 text-right">
                <h4 class="prev-next-part">
                    <a href="/doc/build-and-dist">Building and Distribution »</a>
                </h4>
            </div>
        </div>

        <div class="row mt-0 pt-2 pb-1">

            <div class="col-12 col-md-2">
                <a href="/"><img src="/assets/images/logo-white.svg" alt="Logo"/></a>
            </div>

            <div class="col-12 col-md-4 col-lg-2 ml-auto text-md-right">Copyright (C) <span>2020</span></div>

        </div>

    </div>

</footer>

</div><script src="https://cdn.jsdelivr.net/npm/text-encoding@0.7.0/lib/encoding.min.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-137242493-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-137242493-1');
</script></body></html>